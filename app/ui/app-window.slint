import {
    Button,
    VerticalBox,
    HorizontalBox,
    GridBox,
} from "std-widgets.slint";

export struct NodeStatus {
    running: bool,
    okay: bool,
}


export enum DeviceRelationship{ paired, connected, found }

export struct Device {
    name: string,
    color: color,
    address: string,
    port: int,
    id: [int],
    relationship: DeviceRelationship,
}

component DeviceCard inherits Rectangle {
    in property <Device> device;

    border-radius: 10px;
    background: #123;

    GridLayout {
        Row {
            Text {
                text: device.name;
                font-weight: 2;
            }
        }
    }
}

component Devices {
    in property <[Device]> devices;

    for device in devices: DeviceCard {
        device: device;
    }
}

component NodeButton inherits Rectangle {
    in property <NodeStatus> node_status;
    callback run_node(bool);

    property <bool> query_running: node_status.running;

    property <int> padd:  5;
    // function & pure function

    background: node_status.okay ? gray : yellowgreen;
    border-radius: self.height / 2;

    button_knob := Rectangle {
        height: root.height - padd * 2px;
        width: self.height;
        border-radius: self.height / 2;
        x: query_running ? padd * 1px : root.width - padd * 1px - self.width;
        animate x, background {
            easing: ease-in;
            duration: 100ms;
        }
        y: padd * 1px;
        background: node_status.running ? green : darkgray;

        Rectangle {
            property <int> ipad: 10;
            width: button_knob.width - ipad * 2px;
            height: self.width;
            border-radius: self.width / 2;
            y: ipad * 1px;
            x: ipad * 1px;
            background: button_knob.background.brighter(0.1);
        }
    }

    TouchArea {
        clicked => {
            query_running = !query_running;
            run_node(query_running);
        }
    }
}

component StatusPage {
    callback run_node(bool);
    in property <NodeStatus> node_status;
    in property <[Device]> devices;
    // in property <string> device_name;
    // in property <int> connected_devices;
    // in property <color> device_color;

    VerticalLayout {
        NodeButton {
            x: (root.width - self.width) / 2;
            node_status: node_status;
            width: 200px;
            height: self.width / 2;
            run_node(val) => root.run_node(val);
        }

        Devices {
            devices: devices;
        }
    }
}

export component MainWindow inherits Window {
    in property <NodeStatus> node_status;
    in property <[Device]> devices;

    preferred-height: 400px;
    preferred-width: 300px;

    StatusPage {
        node_status: node_status;
        devices: devices;
    }
}
